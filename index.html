<!DOCTYPE html>
<html lang="tr">
<head>

        <!--
  Spin & Win Landing Page — Implementation Notes / Change Log
  -----------------------------------------------------------
  Summary:
  - Single-file, mobile-first landing page with an 8-segment prize wheel.
  - Lightweight animations, tick sounds (WebAudio), and a guaranteed winner segment.
  - Consent-friendly tracking: Google Consent Mode v2 + optional GA4 & Voluum loaded only after consent.
  - Turkish UI copy for all user-visible strings.

  Implemented by:
  - Christian Bastidas - Acquisition Support Specialist 12-08-2025
  - Notes: Minimal, consent-first tracking; resilient to blockers; no changes required in wheel core logic aside from -90° offset alignment.
  
  Key Functional Changes (latest):
  1) Winner alignment fix:
     - getAngleForIndex(index) adjusted with a -90° pointer offset so the visual pointer matches the actual winning slice.
     - Guaranteed winner via WIN_INDEX constant (0–7).

  2) Cookie banner + preferences panel (Consent Mode v2):
     - Default consent set to denied (except necessary/security).
     - Banner offers: “Accept all”, “Reject all”, “Customize”.
     - Stored in localStorage (key: cmp_prefs_v1).
     - Signals updated via gtag('consent','update', {...}).

  3) Deferred/conditional tracking:
     - GA4 loads only if “Analytics” is granted (GA_MEASUREMENT_ID).
     - Voluum script loads only if “Marketing” is granted; CTA integrates with Voluum when available.
     - Fallbacks in place when blockers prevent script execution.

  4) CTA behavior for tracking (optional):
     - If Voluum is available (window.dtpCallback), clicking the CTA sets dtpCallback.l = VOLUUM_CLICK_URL.
     - Otherwise falls back to OFFICIAL_URL. This preserves tracking without breaking UX.

  5) Modal & UI improvements:
     - Raised modal z-index to 2000 so it always appears above the cookie UI.
     - Centered modal title, tag, and prize text while keeping the close “X” fixed top-right.
     - Removed “Spin Again” button from the modal (close with X / ESC / backdrop).
     - Pointer triangle rotated 180° via CSS (does not affect spin math).

  6) Internationalization:
     - All user-facing strings (wheel labels, headings, buttons, cookie UI, ARIA labels) translated to Turkish.

  Performance considerations:
  - No heavy libraries (vanilla SVG/JS/CSS).
  - Optional <link rel="preconnect" href="https://adviseattline.com" crossorigin> recommended when using Voluum.

  Configuration (search these constants in the script):
  - PROMOTIONS: edit label/detail for each of the 8 segments.
  - WIN_INDEX: set the guaranteed winner index (0..7).
  - OFFICIAL_URL: your direct destination URL.
  - VOLUUM_CLICK_URL: your Voluum /click/... tracking link (loads only if “Marketing” consent is granted).
  - GA_MEASUREMENT_ID: your GA4 ID (loads only if “Analytics” consent is granted).

  Accessibility:
  - Live region for spin status; modal is keyboard dismissible (ESC) and backdrop-click closable.

-->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <title>Çarkıfelek Candy Casino</title>
  <meta name="theme-color" content="#6D00DC" />
  <meta name="description" content="Mobile-first Spin & Win landing page. Lightweight, animated, with sound effects and a guaranteed winning segment." />
  <!-- Consent Mode v2 default (necessary only) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('consent', 'default', {
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      analytics_storage: 'denied',
      functionality_storage: 'granted',
      security_storage: 'granted'
    });
  </script>
  <style>
    /* ------------------------------
       RESET & BASE
       ------------------------------ */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      color: #ffffff;
      background:
        radial-gradient(1000px 600px at 100% 0%, rgba(255, 255, 255, 0.06), transparent 60%),
        radial-gradient(800px 500px at 0% 100%, rgba(255, 255, 255, 0.06), transparent 60%),
        linear-gradient(180deg, #12002f 0%, #160046 40%, #0a0220 100%);
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100dvh; /* for mobile browsers */
    }

    :root {
      /* Color system */
      --primary: #8a2be2;         /* main brand */
      --primary-600: #6d00dc;
      --accent: #00ffd1;          /* neon accent */
      --warn: #ffce00;            /* gold */
      --surface: rgba(255,255,255,.06);
      --surface-strong: rgba(255,255,255,.12);
      --text-dim: rgba(255,255,255,.8);
      --shadow: 0 10px 30px rgba(0,0,0,.35);

      /* Layout */
      --maxw: 1080px;
      --radius-2xl: 24px;
    }

    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    header, footer { padding: 16px; }

    header {
      display: flex; align-items: center; justify-content: center;
    }

    .brand {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 10px 14px; border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }
    .logo-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 16px var(--accent); }

    main { display: grid; place-items: center; padding: 18px; }

    .hero {
      width: 100%;
      max-width: var(--maxw);
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      align-items: center;
    }

    .copy {
      text-align: center;
      padding: 12px 6px;
    }

    h1 {
      margin: 0 0 4px 0;
      font-size: clamp(24px, 6vw, 44px);
      line-height: 1.1;
      letter-spacing: -0.02em;
      text-shadow: 0 6px 30px rgba(0,0,0,.45);
    }
    .subtitle {
      margin: 0 auto;
      max-width: 66ch;
      font-size: clamp(14px, 3.4vw, 18px);
      color: var(--text-dim);
    }

    .stage {
      display: grid;
      grid-template-columns: 1fr;
      place-items: center;
      gap: 18px;
    }

    /* Wheel container */
    .wheel-wrap {
      position: relative;
      width: min(92vw, 480px);
      aspect-ratio: 1 / 1;
      display: grid; place-items: center;
    }

    .wheel {
      width: 100%; height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 50%, #1a0a45, #0b0425 60%);
      border: 10px solid rgba(255,255,255,.08);
      box-shadow: 0 30px 60px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.08);
      position: relative;
      overflow: hidden;
      transform: translateZ(0); /* GPU hint */
    }

    /* Pointer (top) */
    .pointer {
      position: absolute; top: -6px; left: 50%; transform: translateX(-50%) rotate(180deg);
      width: 0; height: 0;
      border-left: 16px solid transparent; border-right:16px solid transparent; border-bottom: 24px solid var(--warn);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.45));
      z-index: 10;
    }

    /* Spin button */
    .actions { display: grid; gap: 10px; place-items: center; }
    .btn-spin {
      appearance: none; border: none; outline: none; cursor: pointer;
      padding: 14px 24px;
      border-radius: 999px;
      background: linear-gradient(180deg, var(--primary) 0%, var(--primary-600) 100%);
      color: #fff; font-weight: 700; letter-spacing: .04em; text-transform: uppercase;
      box-shadow: 0 12px 30px rgba(106, 0, 220, .45), inset 0 0 0 1px rgba(255,255,255,.2);
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
      min-width: 180px; font-size: clamp(14px, 3.6vw, 16px);
    }
    .btn-spin:hover { transform: translateY(-1px); filter: brightness(1.05); }
    .btn-spin:active { transform: translateY(1px) scale(.98); }
    .btn-spin[disabled] { opacity: .6; cursor: not-allowed; filter: grayscale(.2); }

    /* Ring glow */
    .ring {
      position: absolute; inset: 6%; border-radius: 50%;
      pointer-events: none;
      box-shadow:
        0 0 0 12px rgba(255,255,255,.04) inset,
        0 0 40px rgba(138, 43, 226, .45),
        0 0 140px rgba(0, 255, 209, .25);
      animation: pulse 2.6s ease-in-out infinite;
    }
    @keyframes pulse { 50% { box-shadow:
      0 0 0 12px rgba(255,255,255,.04) inset,
      0 0 80px rgba(138, 43, 226, .65),
      0 0 200px rgba(0, 255, 209, .4);
    }}

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; display: none; place-items: center; padding: 18px;
      background: rgba(9, 3, 30, .6);
      backdrop-filter: blur(6px);
      z-index: 2000;
    }
    .modal-backdrop.show { display: grid; animation: fadeIn .18s ease both; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }

    .modal-card {
      width: min(560px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.18);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow);
      color: #fff;
      position: relative;
      overflow: clip;
      animation: pop .22s ease both;
    }
    @keyframes pop { from { transform: translateY(8px) scale(.98); opacity: 0 } to { transform: none; opacity: 1 } }

    .modal-header { display: flex; align-items: center; justify-content: center; padding: 16px 16px 10px; position:relative;}
    .modal-title { font-weight: 800; font-size: clamp(18px, 5vw, 22px); position:absolute; left:50%; transform:translate(-50%); text-align: center;}
    .modal-close {
      appearance: none; border: none; background: transparent; color: #fff; font-size: 22px; cursor: pointer;
      opacity: .9; padding: 6px; border-radius: 10px;
    }
    .modal-close:hover { background: rgba(255,255,255,.08); }

    .modal-body { padding: 0 16px 16px; display: grid; gap: 12px; justify-items:center; text-align:center;}
    .offer-tag {
      display: inline-flex; align-items: center; gap: 8px; width: fit-content; padding: 6px 12px; border-radius: 999px;
      background: rgba(0,0,0,.35); border: 1px solid rgba(255,255,255,.12);
      font-size: 13px; letter-spacing: .02em;
    }
    .modal-actions { display: grid; gap: 10px; grid-auto-flow: row; padding: 10px 16px 18px; }
    .btn {
      appearance: none; border: none; cursor: pointer; color: #0a0220; font-weight: 800;
      border-radius: 14px; padding: 14px 18px; letter-spacing: .04em; text-transform: uppercase;
      background: linear-gradient(180deg, #00ffd1, #00d1ff);
      box-shadow: 0 12px 30px rgba(0, 255, 209, .35), inset 0 0 0 1px rgba(255,255,255,.5);
    }
    .btn.secondary { background: linear-gradient(180deg, #ffd54a, #ffb300); box-shadow: 0 12px 30px rgba(255, 179, 0, .35), inset 0 0 0 1px rgba(255,255,255,.5); }

    /* Confetti container */
    .confetti-zone { position: fixed; inset: 0; pointer-events: none; z-index: 1200; }

    /* Footer */
    footer { text-align: center; color: var(--text-dim); font-size: 12px; }

    /* Accessibility helper (visually hidden) */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    /* Larger layouts */
    @media (min-width: 920px) {
      .hero { grid-template-columns: 1.05fr .95fr; gap: 24px; }
      .copy { text-align: left; padding: 16px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand" aria-label="Brand">
      <span class="logo-dot" aria-hidden="true"></span>
      <strong>Spin & Win</strong>
      <span class="subtitle" style="font-size:12px">Mobil öncelikli • Hızlı • Hafif</span>
    </div>
  </header>

  <main>
    <section class="hero" aria-labelledby="title">
      <div class="copy">
        <h1 id="title">🎉 Çarkı çevir ve bonusunu al!</h1>
        <p class="subtitle">Hiçbir risk yok — çarkı çevir, kazan ve bonusun keyfini hemen çıkar! %100 kazanç garantili.</p>
        <div class="actions">
          <button id="spinBtn" class="btn-spin" aria-live="polite">Çarkı çevir</button>
          <small style="color: var(--text-dim)">En iyi deneyim için sesi aç 🔊</small>
        </div>
      </div>

      <div class="stage">
        <div class="wheel-wrap">
          <div class="pointer" aria-hidden="true"></div>
          <!-- Decorative glow ring -->
          <div class="ring" aria-hidden="true"></div>

          <!-- The wheel SVG (8 slices) -->
          <div id="wheel" class="wheel" role="img" aria-label="8 teklifli ödül çarkı">
            <!-- We'll inject the SVG via JS to keep labels dynamic and crisp -->
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal-backdrop" aria-hidden="true" aria-labelledby="modalTitle" aria-modal="true" role="dialog">
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">Kazandın!</div>
        <button class="modal-close" id="modalClose" aria-label="Close modal">×</button>
      </div>
      <div class="modal-body">
        <span class="offer-tag" id="offerTag">Garantili Ödül</span>
        <p id="offerText" style="margin:0; font-size: clamp(14px, 3.8vw, 16px); color: var(--text-dim)">Özel promosyonun hazır.</p>
      </div>
      <div class="modal-actions">
        <button class="btn" id="claimBtn">Resmi sitede talep et</button>
      </div>
    </div>
  </div>

  <!-- Confetti layer -->
  <div id="confetti" class="confetti-zone" aria-hidden="true"></div>

  <footer>
    © <span id="year"></span> Spin & Win — Tüm hakları saklıdır. |
    <button id="openCookiePanel" class="linklike" type="button">Çerez Ayarları</button>
  </footer>

  <div class="sr-only" aria-live="polite" id="liveRegion"></div>

  <script>
    // ================================
    // CONFIGURATION (edit this block)
    // ================================
    const PROMOTIONS = [
      { label: "%200 + 100 Free Spins", detail: "🎰 %200 Hoş Geldin Bonusu + 100 Free Spin" },
      { label: "5000 TL", detail: "💰 5000 TL Bonus Kazandınız!" },
      { label: "%200 + 5000", detail: "🎯 %200 Bonus + 5000 TL Cashback" },
      { label: "100 Free Spins", detail: "🎁 100 Ücretsiz Dönüş Hediye!" },
      { label: "VIP 5000", detail: "🔥 VIP Bonusu: 5000 TL" },
      { label: "%200 Başlangıç", detail: "🎰 Slotta %200 Başlangıç Bonusu!" },
      { label: "5000 TL Ekstra", detail: "💎 5000 TL Ekstra Kazanç" },
      { label: "Free Spins + Bonus", detail: "🎉 %200 + 100 Free Spin Bonusu!" }
    ];
    // Choose which index always wins (0..7). You can change this anytime.
    const WIN_INDEX = 7; // lands on "Grand Prize" by default

    // Replace with your official site URL
    const OFFICIAL_URL = "https://example.com";

    // Spin behavior
    const FULL_TURNS = 6;     // how many full spins before stopping
    const SPIN_DURATION = 5200; // total spin time in ms (tweak for feel)

    // Sound toggles (enabled by default)
    const SOUND_ENABLED = true;

    // ================================
    // RUNTIME STATE
    // ================================
    const wheelEl = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const modal = document.getElementById('modal');
    const modalClose = document.getElementById('modalClose');
    const offerText = document.getElementById('offerText');
    const offerTag = document.getElementById('offerTag');
    const claimBtn = document.getElementById('claimBtn');
    const confettiZone = document.getElementById('confetti');
    const liveRegion = document.getElementById('liveRegion');

    let currentAngle = 0; // keep track to start next spin from here
    let spinning = false;

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ================================
    // DRAW THE WHEEL AS SVG SEGMENTS
    // ================================
    (function renderWheel(){
      const size = 1000; // large virtual canvas for crispness
      const radius = size/2;
      const segAngle = 360 / PROMOTIONS.length;

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('viewBox', `0 0 ${size} ${size}`);
      svg.setAttribute('width', '100%');
      svg.setAttribute('height', '100%');

      // Build segments
      PROMOTIONS.forEach((promo, i) => {
        const start = (i * segAngle) * Math.PI/180;
        const end = ((i+1) * segAngle) * Math.PI/180;
        const x1 = radius + radius * Math.cos(start);
        const y1 = radius + radius * Math.sin(start);
        const x2 = radius + radius * Math.cos(end);
        const y2 = radius + radius * Math.sin(end);
        const largeArc = segAngle > 180 ? 1 : 0;

        const path = document.createElementNS(svgNS, 'path');
        const d = [
          `M ${radius} ${radius}`,
          `L ${x1} ${y1}`,
          `A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}`,
          'Z'
        ].join(' ');
        path.setAttribute('d', d);
        // Alternating colors for visual separation
        const even = i % 2 === 0;
        const base = even ? '255, 206, 0' : '0, 255, 209';
        const dark = even ? '255, 179, 0' : '0, 209, 255';
        path.setAttribute('fill', `url(#g${i})`);
        path.setAttribute('stroke', 'rgba(0,0,0,.18)');
        path.setAttribute('stroke-width', '2');

        // Gradient per slice
        const defs = svg.querySelector('defs') || (() => { const d=document.createElementNS(svgNS, 'defs'); svg.appendChild(d); return d; })();
        const grad = document.createElementNS(svgNS, 'linearGradient');
        grad.setAttribute('id', `g${i}`);
        grad.setAttribute('x1', '0%'); grad.setAttribute('y1', '0%');
        grad.setAttribute('x2', '0%'); grad.setAttribute('y2', '100%');
        const stop1 = document.createElementNS(svgNS, 'stop'); stop1.setAttribute('offset', '0%'); stop1.setAttribute('stop-color', `rgb(${base})`);
        const stop2 = document.createElementNS(svgNS, 'stop'); stop2.setAttribute('offset', '100%'); stop2.setAttribute('stop-color', `rgb(${dark})`);
        grad.appendChild(stop1); grad.appendChild(stop2); defs.appendChild(grad);

        svg.appendChild(path);

        // Text label along the middle of slice
        const textAngle = (i + 0.5) * segAngle;
        const tx = radius + (radius * 0.6) * Math.cos(textAngle*Math.PI/180);
        const ty = radius + (radius * 0.6) * Math.sin(textAngle*Math.PI/180);
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', tx);
        text.setAttribute('y', ty);
        text.setAttribute('fill', '#0a0220');
        text.setAttribute('font-size', Math.max(30, size * 0.02));
        text.setAttribute('font-weight', '800');
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('dominant-baseline', 'middle');
        text.setAttribute('transform', `rotate(${textAngle}, ${tx}, ${ty})`);
        text.textContent = promo.label;
        svg.appendChild(text);
      });

      // Center hub
      const hub = document.createElementNS(svgNS, 'circle');
      hub.setAttribute('cx', radius); hub.setAttribute('cy', radius); hub.setAttribute('r', radius*0.12);
      hub.setAttribute('fill', 'url(#hubGrad)');
      hub.setAttribute('stroke', 'rgba(0,0,0,.25)'); hub.setAttribute('stroke-width', '4');

      const defs = svg.querySelector('defs') || (() => { const d=document.createElementNS(svgNS, 'defs'); svg.appendChild(d); return d; })();
      const hubGrad = document.createElementNS(svgNS, 'radialGradient');
      hubGrad.setAttribute('id', 'hubGrad');
      const h1 = document.createElementNS(svgNS, 'stop'); h1.setAttribute('offset', '0%'); h1.setAttribute('stop-color', '#ffffff');
      const h2 = document.createElementNS(svgNS, 'stop'); h2.setAttribute('offset', '100%'); h2.setAttribute('stop-color', '#d6d6d6');
      hubGrad.appendChild(h1); hubGrad.appendChild(h2); defs.appendChild(hubGrad);
      svg.appendChild(hub);

      wheelEl.appendChild(svg);
    })();

    // ================================
    // AUDIO: Ticks & Win chime (WebAudio, no files)
    // ================================
    const audioCtx = SOUND_ENABLED && 'AudioContext' in window ? new AudioContext() : null;

    function playTick(){
      if(!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'square';
      o.frequency.value = 1200; // high click
      g.gain.value = 0.0001;
      o.connect(g).connect(audioCtx.destination);
      o.start();
      // quick envelope
      const now = audioCtx.currentTime;
      g.gain.exponentialRampToValueAtTime(0.12, now + 0.001);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
      o.stop(now + 0.07);
    }

    function playWin(){
      if(!audioCtx) return;
      const freqs = [660, 880, 1320];
      const now = audioCtx.currentTime;
      freqs.forEach((f, i) => {
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.frequency.value = f; o.type = 'sine';
        g.gain.value = 0.0001; o.connect(g).connect(audioCtx.destination);
        o.start(now + i * 0.06);
        g.gain.exponentialRampToValueAtTime(0.2, now + i * 0.06 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now + i * 0.06 + 0.35);
        o.stop(now + i * 0.06 + 0.4);
      });
    }

    // ================================
    // SPIN LOGIC
    // ================================
    const SEG_ANGLE = 360 / PROMOTIONS.length; // 45deg for 8 slices

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function getAngleForIndex(index){
      // The pointer graphic is at the TOP of the wheel (~270deg from the +X axis in SVG).
      // Each slice center is (index + 0.5) * SEG_ANGLE from the +X axis.
      // To bring that center under the TOP pointer, rotate an additional -90deg.
      const sliceCenterFromZero = (index + 0.5) * SEG_ANGLE;
      return -(sliceCenterFromZero + 90);
    }

    function spinTo(index){
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      liveRegion.textContent = 'Dönüyor…';
      if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

      const startAngle = currentAngle;
      const targetAngle = getAngleForIndex(index);
      // Add full turns (negative for clockwise under pointer)
      const delta = -FULL_TURNS * 360 + (targetAngle - (startAngle % 360));
      const startTime = performance.now();

      // For tick detection
      let lastTick = normalizeAngle(startAngle);

      function normalizeAngle(a){
        let n = a % 360; if(n < 0) n += 360; return n;
      }

      function animate(now){
        const t = Math.min(1, (now - startTime) / SPIN_DURATION);
        const eased = easeOutCubic(t);
        const angle = startAngle + delta * eased;
        currentAngle = angle;
        wheelEl.style.transform = `rotate(${angle}deg)`;

        // Play tick each time we cross a segment boundary
        const norm = normalizeAngle(angle);
        const step = Math.floor(norm / SEG_ANGLE);
        const lastStep = Math.floor(lastTick / SEG_ANGLE);
        if (step !== lastStep) { playTick(); lastTick = norm; }

        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          // Snap exactly (avoid sub-pixel drift)
          currentAngle = startAngle + delta;
          wheelEl.style.transform = `rotate(${currentAngle}deg)`;
          onSpinEnd(index);
        }
      }
      requestAnimationFrame(animate);
    }

    function onSpinEnd(index){
      // Show modal with the winning promo
      const prize = PROMOTIONS[index];
      offerTag.textContent = prize.label + ' — Kilidi Açıldı';
      offerText.textContent = prize.detail;
      openModal();
      playWin();
      spawnConfetti();
      liveRegion.textContent = `Sonuç: ${prize.label}.`;
    }

    // ================================
    // MODAL UTILS
    // ================================
    function openModal(){
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      // prevent background scroll on mobile
      document.body.style.overflow = 'hidden';
      // Re-enable spin button only after we show the modal
      spinBtn.disabled = false;
    }

    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      spinning = false; // ready for next spin
    }

    modal.addEventListener('click', (e) => {
      // Close if backdrop clicked
      if (e.target === modal) closeModal();
    });
    modalClose.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && modal.classList.contains('show')) closeModal();
    });

    claimBtn.addEventListener('click', () => {
      window.location.href = OFFICIAL_URL; // redirect to your site
    });

    // ================================
    // CONFETTI (tiny, JS only, no libs)
    // ================================
    function spawnConfetti(){
      const count = 80; // lightweight
      for (let i=0; i<count; i++) {
        const c = document.createElement('i');
        const size = Math.random()*8 + 6;
        const left = Math.random()*100;
        const duration = Math.random()*1.2 + 1.3;
        const delay = Math.random()*0.2;
        c.style.position = 'absolute';
        c.style.left = left + 'vw';
        c.style.top = '-10px';
        c.style.width = size + 'px';
        c.style.height = size + 'px';
        c.style.background = `hsl(${Math.random()*360}, 90%, 60%)`;
        c.style.transform = `rotate(${Math.random()*360}deg)`;
        c.style.opacity = '0.95';
        c.style.borderRadius = Math.random() > .5 ? '2px' : '50%';
        c.style.filter = 'drop-shadow(0 2px 4px rgba(0,0,0,.2))';
        c.animate([
          { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
          { transform: `translateY(100vh) rotate(${Math.random()*720 - 360}deg)`, opacity: .9 }
        ], { duration: duration*1000, delay: delay*1000, easing: 'cubic-bezier(.2,.8,.2,1)', fill: 'forwards' });
        confettiZone.appendChild(c);
        setTimeout(()=> c.remove(), (duration+delay)*1000 + 100);
      }
    }

    // ================================
    // INIT: Bind spin button
    // ================================
    spinBtn.addEventListener('click', () => {
      if (spinning) return;
      spinTo(WIN_INDEX); // always land on this index
    });

    // Prevent double-tap zoom on iOS while tapping button
    let lastTouch = 0;
    document.addEventListener('touchend', (e)=>{
      const now = Date.now();
      if(now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, { passive:false });
  </script>
<!-- ===== Cookie Consent (Banner + Panel) ===== -->
  <div class="cookie-banner" id="cookieBanner" role="dialog" aria-live="polite" aria-modal="true" aria-label="Cookie consent">
    <div class="cookie-card">
      <h2>Bu sitede çerezler</h2>
      <p>Gerekli çerezleri sitenin çalışması için kullanıyoruz. Onayınızla, deneyimi iyileştirmek ve ilgili teklifleri göstermek için analitik ve pazarlama çerezlerini de kullanacağız.</p>
      <div class="cookie-actions">
        <button id="cookieReject" type="button" class="btn secondary">Tümünü reddet</button>
        <button id="cookieÖzelleştir" type="button" class="btn">Özelleştir</button>
        <button id="cookieAccept" type="button" class="btn">Tümünü kabul et</button>
      </div>
    </div>
  </div>

  <div class="cookie-panel" id="cookiePanel" role="dialog" aria-modal="true" aria-labelledby="cookiePanelTitle" hidden>
    <div class="cookie-card">
      <div class="cookie-header">
        <h3 id="cookiePanelTitle">Çerez tercihleri</h3>
        <button id="cookieClose" aria-label="Close" type="button">×</button>
      </div>
      <ul class="cookie-list">
        <li>
          <label><input type="checkbox" checked disabled> Gerekli (her zaman açık)</label>
          <small>Temel site işlevleri ve güvenliği için gereklidir.</small>
        </li>
        <li>
          <label><input id="ckAnalitik" type="checkbox"> Analitik</label>
          <small>Kullanımı anlayıp ürünü geliştirmemize yardımcı olur.</small>
        </li>
        <li>
          <label><input id="ckPazarlama" type="checkbox"> Pazarlama</label>
          <small>Reklam ve takip amaçlı kullanılır (ör. Voluum).
          </small>
        </li>
      </ul>
      <div class="cookie-actions">
        <button id="cookieSave" type="button" class="btn secondary">Tercihleri kaydet</button>
        <button id="cookieAcceptAll2" type="button" class="btn">Tümünü kabul et</button>
      </div>
    </div>
  </div>

  <!-- Styles for cookie UI and link-like button -->
  <style>
    .linklike{background:none;border:0;cursor:pointer;color:var(--accent);text-decoration:underline;padding:0;font:inherit}
    .cookie-banner, .cookie-panel{position:fixed;inset:auto 0 0 0;display:none;z-index:1200;background:rgba(9,3,30,.75);backdrop-filter:blur(6px);padding:12px}
    .cookie-banner.show{display:grid;place-items:center}
    .cookie-panel[hidden]{display:none}
    .cookie-panel{inset:0;display:grid;place-items:center}
    .cookie-card{width:min(720px,96vw);background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));border:1px solid rgba(255,255,255,.18);border-radius:16px;color:#fff;box-shadow:var(--shadow);padding:16px;display:grid;gap:12px}
    .cookie-actions{display:grid;grid-auto-flow:column;gap:8px;justify-content:end}
    .cookie-header{display:flex;align-items:center;justify-content:space-between}
    .cookie-header button{appearance:none;border:0;background:transparent;color:#fff;font-size:22px;cursor:pointer;padding:6px;border-radius:10px}
    .cookie-header button:hover{background:rgba(255,255,255,.08)}
    .cookie-list{list-style:none;margin:0;padding:0;display:grid;gap:10px}
    .cookie-list small{display:block;color:var(--text-dim)}
    @media (max-width:560px){.cookie-actions{grid-auto-flow:row;justify-items:stretch}}
  </style>

  <!-- Logic: Consent storage + loaders (GA/Voluum) -->
  <script>
    const CMP_KEY = 'cmp_prefs_v1';
    const GA_MEASUREMENT_ID = 'G-XXXXXXX'; // <-- set your GA4 ID or leave placeholder
    const VOLUUM_CLICK_URL = 'https://adviseattline.com/click/XXXX'; // <-- set your Voluum click URL

    const banner = document.getElementById('cookieBanner');
    const panel  = document.getElementById('cookiePanel');
    const openPanelBtn = document.getElementById('openCookiePanel');

    const ckAnalitik = document.getElementById('ckAnalitik');
    const ckPazarlama = document.getElementById('ckPazarlama');

    const btnAccept = document.getElementById('cookieAccept');
    const btnReject = document.getElementById('cookieReject');
    const btnÖzelleştir = document.getElementById('cookieÖzelleştir');

    const btnClose = document.getElementById('cookieClose');
    const btnSave = document.getElementById('cookieSave');
    const btnAcceptAll2 = document.getElementById('cookieAcceptAll2');

    const loadPrefs = () => { try { return JSON.parse(localStorage.getItem(CMP_KEY) || 'null'); } catch { return null; } };
    const savePrefs = (p) => { const prefs = { ...p, timestamp: Date.now() }; localStorage.setItem(CMP_KEY, JSON.stringify(prefs)); return prefs; };

    function updateConsent(prefs){
      if (typeof gtag === 'function') {
        gtag('consent','update', {
          analytics_storage: prefs.analytics ? 'granted' : 'denied',
          ad_storage:        prefs.marketing ? 'granted' : 'denied',
          ad_user_data:      prefs.marketing ? 'granted' : 'denied',
          ad_personalization:prefs.marketing ? 'granted' : 'denied'
        });
      }
      if(prefs.analytics && !window.__gaLoaded && GA_MEASUREMENT_ID && GA_MEASUREMENT_ID !== 'G-XXXXXXX') loadGA();
      if(prefs.marketing && !window.__voluumLoaded && VOLUUM_CLICK_URL && VOLUUM_CLICK_URL.includes('/click/')) loadVoluum();
    }

    function loadGA(){
      window.__gaLoaded = true;
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_MEASUREMENT_ID;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      gtag('js', new Date());
      gtag('config', GA_MEASUREMENT_ID, { anonymize_ip: true });
    }

    function loadVoluum(){
      window.__voluumLoaded = true;
      const s = document.createElement('script');
      s.defer = true;
      s.src = 'https://adviseattline.com/d/.js?lpref=' + encodeURIComponent(document.referrer) + '&lpurl=' + encodeURIComponent(location.href) + '&lpt=' + encodeURIComponent(document.title) + '&vtm=' + Date.now();
      document.head.appendChild(s);
    }

    function showBanner(){ banner.classList.add('show'); }
    function hideBanner(){ banner.classList.remove('show'); }
    function openPanel(){ panel.hidden = false; }
    function closePanel(){ panel.hidden = true; }

    openPanelBtn && openPanelBtn.addEventListener('click', () => {
      const p = loadPrefs();
      ckAnalitik.checked = !!(p && p.analytics);
      ckPazarlama.checked = !!(p && p.marketing);
      openPanel();
    });

    btnAccept.addEventListener('click', () => { const prefs = savePrefs({ necessary:true, analytics:true, marketing:true }); hideBanner(); closePanel(); updateConsent(prefs); });
    btnReject.addEventListener('click', () => { const prefs = savePrefs({ necessary:true, analytics:false, marketing:false }); hideBanner(); closePanel(); updateConsent(prefs); });
    btnÖzelleştir.addEventListener('click', () => { const p = loadPrefs(); ckAnalitik.checked = !!(p && p.analytics); ckPazarlama.checked = !!(p && p.marketing); openPanel(); });

    btnClose.addEventListener('click', closePanel);
    btnSave.addEventListener('click', () => { const prefs = savePrefs({ necessary:true, analytics: ckAnalitik.checked, marketing: ckPazarlama.checked }); hideBanner(); closePanel(); updateConsent(prefs); });
    btnAcceptAll2.addEventListener('click', () => { const prefs = savePrefs({ necessary:true, analytics:true, marketing:true }); hideBanner(); closePanel(); updateConsent(prefs); });

    (function initCMP(){ const p = loadPrefs(); if(!p){ showBanner(); } else { updateConsent(p); } })();
  </script>

</body>
</html>
